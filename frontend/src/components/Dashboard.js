import React, { useState, useEffect } from 'react';\nimport {\n  Grid, Card, CardContent, Typography, Box, Avatar,\n  LinearProgress, Chip, Button, IconButton, Divider,\n  List, ListItem, ListItemText, ListItemAvatar\n} from '@mui/material';\nimport {\n  TrendingUp, TrendingDown, People, Psychology,\n  LocalHospital, Scanner, Analytics, Refresh,\n  Person, Schedule, Emergency\n} from '@mui/icons-material';\nimport { motion } from 'framer-motion';\nimport { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, ResponsiveContainer } from 'recharts';\n\nconst Dashboard = ({ onPatientSelect }) => {\n  const [stats, setStats] = useState({\n    totalPatients: 1247,\n    aiAnalyses: 892,\n    criticalCases: 23,\n    todayScans: 156\n  });\n\n  const [recentPatients] = useState([\n    { id: 'P001', name: 'John Smith', diagnosis: 'Glioma', time: '2 min ago', severity: 'high' },\n    { id: 'P002', name: 'Sarah Johnson', diagnosis: 'Meningioma', time: '15 min ago', severity: 'medium' },\n    { id: 'P003', name: 'Mike Wilson', diagnosis: 'Pituitary', time: '32 min ago', severity: 'low' },\n    { id: 'P004', name: 'Emma Davis', diagnosis: 'No Tumor', time: '1 hour ago', severity: 'low' },\n  ]);\n\n  const diagnosisData = [\n    { name: 'Glioma', value: 35, color: '#ef4444' },\n    { name: 'Meningioma', value: 28, color: '#f59e0b' },\n    { name: 'Pituitary', value: 22, color: '#10b981' },\n    { name: 'No Tumor', value: 15, color: '#6b7280' },\n  ];\n\n  const monthlyData = [\n    { month: 'Jan', scans: 120, analyses: 98 },\n    { month: 'Feb', scans: 135, analyses: 112 },\n    { month: 'Mar', scans: 148, analyses: 125 },\n    { month: 'Apr', scans: 162, analyses: 138 },\n    { month: 'May', scans: 156, analyses: 142 },\n  ];\n\n  const StatCard = ({ title, value, change, icon, color, subtitle }) => (\n    <motion.div\n      whileHover={{ scale: 1.02 }}\n      transition={{ duration: 0.2 }}\n    >\n      <Card sx={{ height: '100%', position: 'relative', overflow: 'visible' }}>\n        <CardContent sx={{ p: 3 }}>\n          <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>\n            <Box>\n              <Typography variant=\"h4\" sx={{ fontWeight: 700, color: color, mb: 0.5 }}>\n                {value.toLocaleString()}\n              </Typography>\n              <Typography variant=\"body2\" color=\"text.secondary\" sx={{ mb: 1 }}>\n                {title}\n              </Typography>\n              {subtitle && (\n                <Typography variant=\"caption\" color=\"text.secondary\">\n                  {subtitle}\n                </Typography>\n              )}\n            </Box>\n            <Avatar sx={{ bgcolor: `${color}20`, color: color, width: 56, height: 56 }}>\n              {icon}\n            </Avatar>\n          </Box>\n          \n          {change && (\n            <Box sx={{ display: 'flex', alignItems: 'center', mt: 2 }}>\n              {change > 0 ? (\n                <TrendingUp sx={{ color: 'success.main', fontSize: 16, mr: 0.5 }} />\n              ) : (\n                <TrendingDown sx={{ color: 'error.main', fontSize: 16, mr: 0.5 }} />\n              )}\n              <Typography \n                variant=\"caption\" \n                sx={{ \n                  color: change > 0 ? 'success.main' : 'error.main',\n                  fontWeight: 600\n                }}\n              >\n                {Math.abs(change)}% from last month\n              </Typography>\n            </Box>\n          )}\n        </CardContent>\n      </Card>\n    </motion.div>\n  );\n\n  const getSeverityColor = (severity) => {\n    switch (severity) {\n      case 'high': return 'error';\n      case 'medium': return 'warning';\n      case 'low': return 'success';\n      default: return 'default';\n    }\n  };\n\n  return (\n    <Box>\n      {/* Welcome Section */}\n      <motion.div\n        initial={{ opacity: 0, y: -20 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ duration: 0.5 }}\n      >\n        <Box sx={{ mb: 4, p: 3, bgcolor: 'primary.main', borderRadius: 3, color: 'white' }}>\n          <Typography variant=\"h4\" sx={{ fontWeight: 700, mb: 1 }}>\n            Welcome to AI-Powered EHR System\n          </Typography>\n          <Typography variant=\"body1\" sx={{ opacity: 0.9 }}>\n            Advanced medical imaging analysis with artificial intelligence\n          </Typography>\n        </Box>\n      </motion.div>\n\n      {/* Stats Cards */}\n      <Grid container spacing={3} sx={{ mb: 4 }}>\n        <Grid item xs={12} sm={6} md={3}>\n          <StatCard\n            title=\"Total Patients\"\n            value={stats.totalPatients}\n            change={12}\n            icon={<People />}\n            color=\"#2563eb\"\n            subtitle=\"Active in system\"\n          />\n        </Grid>\n        <Grid item xs={12} sm={6} md={3}>\n          <StatCard\n            title=\"AI Analyses\"\n            value={stats.aiAnalyses}\n            change={8}\n            icon={<Psychology />}\n            color=\"#7c3aed\"\n            subtitle=\"Completed this month\"\n          />\n        </Grid>\n        <Grid item xs={12} sm={6} md={3}>\n          <StatCard\n            title=\"Critical Cases\"\n            value={stats.criticalCases}\n            change={-5}\n            icon={<Emergency />}\n            color=\"#ef4444\"\n            subtitle=\"Requiring attention\"\n          />\n        </Grid>\n        <Grid item xs={12} sm={6} md={3}>\n          <StatCard\n            title=\"Today's Scans\"\n            value={stats.todayScans}\n            change={15}\n            icon={<Scanner />}\n            color=\"#10b981\"\n            subtitle=\"MRI, CT, X-Ray\"\n          />\n        </Grid>\n      </Grid>\n\n      <Grid container spacing={3}>\n        {/* Diagnosis Distribution */}\n        <Grid item xs={12} md={6}>\n          <motion.div\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ duration: 0.5, delay: 0.2 }}\n          >\n            <Card sx={{ height: 400 }}>\n              <CardContent sx={{ p: 3 }}>\n                <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 3 }}>\n                  <Typography variant=\"h6\" sx={{ fontWeight: 600 }}>\n                    Diagnosis Distribution\n                  </Typography>\n                  <IconButton size=\"small\">\n                    <Refresh />\n                  </IconButton>\n                </Box>\n                <ResponsiveContainer width=\"100%\" height={280}>\n                  <PieChart>\n                    <Pie\n                      data={diagnosisData}\n                      cx=\"50%\"\n                      cy=\"50%\"\n                      innerRadius={60}\n                      outerRadius={100}\n                      paddingAngle={5}\n                      dataKey=\"value\"\n                    >\n                      {diagnosisData.map((entry, index) => (\n                        <Cell key={`cell-${index}`} fill={entry.color} />\n                      ))}\n                    </Pie>\n                    <Tooltip />\n                  </PieChart>\n                </ResponsiveContainer>\n                <Box sx={{ display: 'flex', flexWrap: 'wrap', gap: 1, mt: 2 }}>\n                  {diagnosisData.map((item) => (\n                    <Chip\n                      key={item.name}\n                      label={`${item.name} (${item.value}%)`}\n                      size=\"small\"\n                      sx={{ bgcolor: `${item.color}20`, color: item.color }}\n                    />\n                  ))}\n                </Box>\n              </CardContent>\n            </Card>\n          </motion.div>\n        </Grid>\n\n        {/* Monthly Trends */}\n        <Grid item xs={12} md={6}>\n          <motion.div\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            transition={{ duration: 0.5, delay: 0.3 }}\n          >\n            <Card sx={{ height: 400 }}>\n              <CardContent sx={{ p: 3 }}>\n                <Typography variant=\"h6\" sx={{ fontWeight: 600, mb: 3 }}>\n                  Monthly Analysis Trends\n                </Typography>\n                <ResponsiveContainer width=\"100%\" height={280}>\n                  <BarChart data={monthlyData}>\n                    <CartesianGrid strokeDasharray=\"3 3\" />\n                    <XAxis dataKey=\"month\" />\n                    <YAxis />\n                    <Tooltip />\n                    <Bar dataKey=\"scans\" fill=\"#2563eb\" radius={[4, 4, 0, 0]} />\n                    <Bar dataKey=\"analyses\" fill=\"#7c3aed\" radius={[4, 4, 0, 0]} />\n                  </BarChart>\n                </ResponsiveContainer>\n              </CardContent>\n            </Card>\n          </motion.div>\n        </Grid>\n\n        {/* Recent Patients */}\n        <Grid item xs={12}>\n          <motion.div\n            initial={{ opacity: 0, y: 20 }}\n            animate={{ opacity: 1, y: 0 }}\n            transition={{ duration: 0.5, delay: 0.4 }}\n          >\n            <Card>\n              <CardContent sx={{ p: 3 }}>\n                <Box sx={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', mb: 3 }}>\n                  <Typography variant=\"h6\" sx={{ fontWeight: 600 }}>\n                    Recent Patient Analyses\n                  </Typography>\n                  <Button variant=\"outlined\" size=\"small\">\n                    View All\n                  </Button>\n                </Box>\n                <List>\n                  {recentPatients.map((patient, index) => (\n                    <motion.div\n                      key={patient.id}\n                      initial={{ opacity: 0, x: -20 }}\n                      animate={{ opacity: 1, x: 0 }}\n                      transition={{ duration: 0.3, delay: index * 0.1 }}\n                    >\n                      <ListItem\n                        sx={{\n                          borderRadius: 2,\n                          mb: 1,\n                          '&:hover': { bgcolor: 'action.hover', cursor: 'pointer' },\n                        }}\n                        onClick={() => onPatientSelect && onPatientSelect({ patient_id: patient.id, name: patient.name })}\n                      >\n                        <ListItemAvatar>\n                          <Avatar sx={{ bgcolor: 'primary.main' }}>\n                            <Person />\n                          </Avatar>\n                        </ListItemAvatar>\n                        <ListItemText\n                          primary={\n                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1 }}>\n                              <Typography variant=\"subtitle1\" sx={{ fontWeight: 600 }}>\n                                {patient.name}\n                              </Typography>\n                              <Chip\n                                label={patient.diagnosis}\n                                size=\"small\"\n                                color={getSeverityColor(patient.severity)}\n                                variant=\"outlined\"\n                              />\n                            </Box>\n                          }\n                          secondary={\n                            <Box sx={{ display: 'flex', alignItems: 'center', gap: 1, mt: 0.5 }}>\n                              <Schedule sx={{ fontSize: 14, color: 'text.secondary' }} />\n                              <Typography variant=\"caption\" color=\"text.secondary\">\n                                {patient.time} â€¢ ID: {patient.id}\n                              </Typography>\n                            </Box>\n                          }\n                        />\n                      </ListItem>\n                      {index < recentPatients.length - 1 && <Divider />}\n                    </motion.div>\n                  ))}\n                </List>\n              </CardContent>\n            </Card>\n          </motion.div>\n        </Grid>\n      </Grid>\n    </Box>\n  );\n};\n\nexport default Dashboard;